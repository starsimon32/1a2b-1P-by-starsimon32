<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>1A2B æ”¹ç‰ˆ62</title>
<style>
/* æ–‡å­—é¡è‰² */
#left { color: #dc2626; }
#result { color: #16a34a; font-weight: bold; }
#hint   { color: #2563eb; }
#help   { color: #9333ea; }
#candidates {
    white-space: pre-line; /* è®“å…ƒç´ èƒ½è¾¨è­˜ \n ä¸¦æ›è¡Œ */
    color: #ffbfdd;
}
/* æ•´å€‹ç•«é¢ç½®ä¸­ */
body {
    margin: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #f2f2f2;
    font-family: Arial, sans-serif;
}

/* éŠæˆ²ä¸»é¢æ¿ */
#app {
    width: 420px;
    background-color: white;
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
}
input { width: 80px; text-align: center; }

.start-title { text-align: center; font-size: 32px; color: #2c3e50; }
.game-title { text-align: center; font-size: 34px; color: #3498db; }
.win-title { text-align: center; font-size: 36px; color: #27ae60; }
.lose-title { text-align: center; font-size: 32px; color: #7f8c8d; }

button {
    margin: 4px;
    padding: 8px 14px;
    font-size: 16px;
    transition: 0.2s;
    cursor: pointer;
}
button:hover { transform: scale(1.05); }

.btn-group {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 10px;
}
.main-btn button { background-color: #3498db; color: white; }
.helper-btn button { background-color: #95a5a6; color: white; }
.danger-btn button { background-color: #e74c3c; color: white; }
</style>
</head>
<body onload="renderStartPage()">
<div id="app"></div>

<script>
/* ========= å…¨åŸŸç‹€æ…‹ ========= */
const state = {
    playerName: "",
    digit: 4,
    useRepeat: false,
    low: "0",
    high: "9",
    answer: "",
    guesscount: 0,
    haveGuessed: false,
    answerbyuser: false,
    starttime: 0,
    candidates:[],
    candidatescomputer:[],
    history: [],
    historybycomputer:[],
    difficulty:0,
    seeother:false,
    mode4_computerguess:""
};

const allowedChars = "0123456789abcdefghijklmnopqrstuvwxyz";

/* ========= ç‰Œçµ„ ========= */
function initialcandidates(){
    state.candidates=generatepossibilities();
}
function initialcandidates2(){
    if(state.history.length === 0) return;
    state.candidates=generatepossibilities2();
}
function deletecandidates(a){
    if(a===true){
        if(state.history.length === 0) return;
        if(state.candidates.length === 0) return;
         state.candidates = state.candidates.filter(s => checkAplusB(s, state.history[state.history.length-1].guess) === (state.history[state.history.length-1].A + state.history[state.history.length-1].B));

        }else{
        if(state.historybycomputer.length === 0) return;
        if(state.candidatescomputer.length === 0) return;
         state.candidatescomputer = state.candidatescomputer.filter(s => checkAplusB(s, state.historybycomputer[state.historybycomputer.length-1].guess) === (state.historybycomputer[state.historybycomputer.length-1].A + state.historybycomputer[state.historybycomputer.length-1].B));
}
    
}
function seeanddeletecandidates(){
    const setComputer = new Set(state.candidatescomputer);
    const intersection = state.candidates.filter(x => setComputer.has(x));
    let a=intersection.slice();
    state.candidates = a;          // æ–°é™£åˆ—
    state.candidatescomputer = a;  // æ–°é™£åˆ—
}

   
function initialcandidatescomputer(){
    state.candidatescomputer=generatepossibilities();
}
function showcandidates(){
    if(state.candidates.length === 0){
    alert("å°šæœªå»ºç«‹å€™é¸é›†åˆ");
    return;
    }
    if(Istoobig()===2){
        alert("æ•¸å­—å¤ªå¤§ä¸å¯ä»¥ç”¨");
        return;
    }
    if(Istoobig()===1&&state.guesscount===0){
        alert("æ•¸å­—å¤ªå¤§ï¼Œç¬¬ä¸€æ¬¡ä¸å¯ç”¨");
        return;
    }
    let text="å¯èƒ½çš„å€™é¸äºº\n";
    text+=state.candidates.join(",");
    text+="\nç„¶å¾Œé‡æ–°çµ„åˆ";
    document.getElementById("candidates").innerText=`${text} `;
}
function getPermutations(str) {
    if (str.length === 1) return [str];
    let result = [];
    for (let i = 0; i < str.length; i++) {
        const char = str[i];                 
        const remaining = str.slice(0,i) + str.slice(i+1); 
        const perms = getPermutations(remaining);          
        for (const perm of perms) {
            result.push(char + perm);
        }
    }
    return deletesame(result);
}
function generatepossibilities() {
  let min = state.low;
  let max = state.high;
  let length = state.digit;
  let repeat = state.useRepeat;

  const numbers = [];
  for (let i = CharToInt(min); i <= CharToInt(max); i++) {
    numbers.push(allowedChars[i]);
}

  let results = [];

  function backtrack(startIndex, current) {
    if (current.length === length) {
      results.push(current.join(""));
      return;
    }

    for (let i = startIndex; i < numbers.length; i++) {
      current.push(numbers[i]);
      backtrack(repeat ? i : i + 1, current);
      current.pop();
    }
  }

  backtrack(0, []);
return deletesame(results);
}

function generatepossibilities2() {
  let min = state.low;
  let max = state.high;
  let length = state.digit;
  let repeat = state.useRepeat;

  const numbers = [];
  for (let i = CharToInt(min); i <= CharToInt(max); i++) {
    numbers.push(allowedChars[i]);
}

  let results = [];

  function backtrack(startIndex, current) {
    if (current.length === length&& checkAplusB(current.join(""),state.history[0].guess)===(state.history[0].A+state.history[0].B)) {
      results.push(current.join(""));
      return;
    }

    for (let i = startIndex; i < numbers.length; i++) {
      current.push(numbers[i]);
      backtrack(repeat ? i : i + 1, current);
      current.pop();
    }
  }

  backtrack(0, []);
return deletesame(results);
}
/* ========= æ™‚é–“ ========= */
function givenow(){ return Date.now(); }
function spendtime(){ return (Date.now()-state.starttime)/1000; }

/* ========= å·¥å…· ========= */
function Istoobig(){
    let a=CharToInt(state.high)-CharToInt(state.low)+1;
    let b=state.digit;
    let c=Math.pow(a, b);
    if(c>=1000000){
        return 2;
    }
    else if (c>=100000){
        return 1;
    }
    else{
        return 0;
    }
}
function CharToInt(c){ return allowedChars.indexOf(c); }
function checkrepeat(s){ for(let i=0;i<s.length;i++) for(let j=i+1;j<s.length;j++) if(s[i]===s[j]) return false; return true; }
function charadd1(c){ let a=CharToInt(c); if(a===CharToInt(state.high)) a=CharToInt(state.low); else a++; return allowedChars[a]; }
function stringadd1(s){ let a=s.split(""); a[a.length-1]=charadd1(a[a.length-1]); for(let i=a.length-1;i>0;i--){ if(a[i]===state.low) a[i-1]=charadd1(a[i-1]); else break; } return a.join(""); }
function countChar(s,c){ return [...s].filter(x=>x===c).length; }
function deletesame(st){
    let array=st;
    let Ifdelete=[];
    for(let i=0;i<array.length;i++){
        Ifdelete.push(0);
    }
     for(let i=0;i<array.length;i++){
        if(Ifdelete[i]===1){
            continue;
        }
        for(let j=i+1;j<array.length;j++){
             if(array[i]===array[j]){
                 Ifdelete[j]=1;
             }
         }
    }
    let outputarray=[];
    for(let i=0;i<array.length;i++){
        if(Ifdelete[i]===0){
            outputarray.push(array[i]);
        }
    }
    return outputarray;
}
function randomize(str){
    let s=str.split("");
    let output=[];
    let originallength=s.length;
    for(let i=0;i<originallength;i++){
        let num=Math.floor(Math.random() * s.length);
        output.push(s[num]);
        s.splice(num, 1);
    }
    return output.join("");
}
/* ========= é–‹å§‹ç•«é¢ ========= */
function renderStartPage(){
    state.difficulty=0;
    state.historybycomputer = [];
    state.history= [];
    state.answerbyuser=false;
    const app=document.getElementById("app");
    app.innerHTML=`
        <h2 class="start-title">æ­¡è¿ä¾†åˆ°1A2B</h2>
        ç©å®¶åç¨± <input id="nameInput" value="${state.playerName}"><br><br>
        ä½æ•¸ <input id="digitInput" type="number" value="${state.digit}"><br><br>
        æœ€ä½ä½ <input id="lowInput" value="${state.low}" maxlength="1"><br><br>
        æœ€é«˜ä½ <input id="highInput" value="${state.high}" maxlength="1"><br><br>
        å…è¨±é‡è¤‡ <input type="checkbox" id="useRepeat" ${state.useRepeat?"checked":""}><br><br>
        <div class="btn-group danger-btn">
            <button onclick="startGame()">é›»è…¦å‡ºé¡Œ</button>
            <button onclick="startGame2()">æˆ‘ä¾†å‡ºé¡Œ</button>
            <button onclick="startGame3()">å’Œé›»è…¦æ¯”è³½(å…±åŒç­”æ¡ˆ)</button>
            <button onclick="startGame4()">å’Œé›»è…¦æ¯”è³½(äº’ç›¸å‡ºé¡Œ)</button>
            <button onclick="describe()">è¦å‰‡èªªæ˜</button>
        </div>
    `;
}

/* ========= èªªæ˜ ========= */
function describe(){
    const app=document.getElementById("app");
    app.innerHTML=`
        <h2 class="start-title">è¦å‰‡èªªæ˜</h2>
        <span style="font-size: 20px; color: #ffcc00; font-weight: bold;">éŠæˆ²è¦å‰‡ï¼š</span><br>ç­”æ¡ˆç”±ç©å®¶è¨­å®šï¼ŒåŒ…å«é‡è¤‡æˆ–ä¸é‡è¤‡ã€ä½æ•¸åŠå¹¾é€²ä½(æœ¬éŠæˆ²æ”¯æ´36é€²ä½ a=10 ã€b=11.. z=35)<br>
        <span style="font-size: 20px; color: #ffcc00; font-weight: bold;">æç¤ºæŒ‰éˆ•ï¼š</span><br>è¼¸å…¥è‡ªå·±çš„ç­”æ¡ˆå¾Œï¼Œå‘Šè¨´ä½¿ç”¨è€…æ˜¯å¦èˆ‡æ­·å²ç´€éŒ„çŸ›ç›¾<br>
        <span style="font-size: 20px; color: #ffcc00; font-weight: bold;">æˆ‘ä¾†æç¤ºç³»çµ±çŒœæŒ‰éˆ•ï¼š</span><br>(æ­¤æ­¥é©Ÿæœƒæ¶ˆè€—ä¸€æ¬¡çŒœçš„æ©Ÿæœƒï¼Œè«‹è¬¹æ…ä½¿ç”¨)è¼¸å…¥ä¸€å€‹ç¬¦åˆé•·åº¦å’Œä¸Šä¸‹ç•Œçš„æ•¸å­—ï¼Œç³»çµ±å¹«ä½ æ’æˆå’Œå‰é¢å¹¾æ¬¡çŒœæ¸¬éƒ½ä¸çŸ›ç›¾çš„çµ„åˆï¼Œæ³¨æ„åˆ°å‡è¨­ç„¡è«–æ€éº¼æ¹Šéƒ½æœƒçŸ›ç›¾ï¼Œç³»çµ±æœƒè‡ªå‹•çŒœä¸€é–‹å§‹è¼¸å…¥çš„æ•¸<br>
        <span style="font-size: 20px; color: #ffcc00; font-weight: bold;">å’Œé›»è…¦æ¯”è³½(å…±åŒç­”æ¡ˆ)</span><br>é›»è…¦éš¨æ©Ÿç”Ÿæˆä¸€å€‹ç­”æ¡ˆï¼Œç„¶å¾Œäº’ç›¸æ¯”è³½<br>
        <span style="font-size: 20px; color: #ffcc00; font-weight: bold;">å’Œé›»è…¦æ¯”è³½(å„è‡ªç­”æ¡ˆ)</span><br>å„è‡ªå‡ºä¸€å€‹ï¼Œç„¶å¾Œäº’ç›¸æ¯”è³½(åªæœ‰å›°é›£ä¸Šé›£åº¦)<br>
        <span style="font-size: 25px; color: #ff1100; font-weight: bold;">ä»¥ä¸‹é€™äº›æŒ‰éˆ•åœ¨å¯èƒ½æ€§å¤ªå¤§æ™‚å°‡ç„¡æ³•åŸ·è¡Œ</span><br>
        <span style="font-size: 20px; color: #ffcc00; font-weight: bold;">å¹«åŠ©æŒ‰éˆ•ï¼š</span><br>æä¾›ä¸€çµ„èˆ‡æ­·å²ç´€éŒ„ä¸çŸ›ç›¾çš„ç­”æ¡ˆ<br>
        <span style="font-size: 20px; color: #ffcc00; font-weight: bold;">é¡¯ç¤ºå‰©é¤˜è§£æŒ‰éˆ•ï¼š</span><br>è¨ˆç®—å‰©é¤˜å¯èƒ½çµ„åˆ<br>        
        <span style="font-size: 20px; color: #ffcc00; font-weight: bold;">é¡¯ç¤ºå€™é¸äººæŒ‰éˆ•ï¼š</span><br>ç›´æ¥å‘Šè¨´ä½ é‚„æœ‰å“ªäº›çµ„åˆï¼Œä¸éå»ºè­°é…åˆ"æˆ‘ä¾†æç¤ºç³»çµ±çŒœæŒ‰éˆ•"<br>
        <div class="btn-group danger-btn">
            <button onclick="renderStartPage()">å›é–‹å§‹</button>
        </div>
    `;
}

/* ========= å’Œé›»è…¦æ¯”è³½ ========= */
function startGame4(){
    if(Istoobig()!==0){
        alert("å¤ªå¤šä½æ•¸äº†ï¼Œé€™æ¨£é›»è…¦æœƒçˆ†ç‚¸");
        return;
    }
    state.guesscount=0;
    state.haveGuessed=false;
    state.playerName=document.getElementById("nameInput").value;
    state.digit=Number(document.getElementById("digitInput").value);
    state.useRepeat=document.getElementById("useRepeat").checked;
    state.low=document.getElementById("lowInput").value;
    state.high=document.getElementById("highInput").value;

    if(state.playerName.length===0){ alert("è«‹è¼¸å…¥ç©å®¶åç¨±"); return; }
    if(CharToInt(state.low)===-1||CharToInt(state.high)===-1){ alert("æœ€ä½æˆ–æœ€é«˜ä½ä¸åˆæ³•"); return; }
    if(CharToInt(state.high)<CharToInt(state.low)){ alert("æœ€é«˜ä½ä¸èƒ½å°æ–¼æœ€ä½ä½"); return; }
    if(!state.useRepeat && CharToInt(state.high)-CharToInt(state.low)+1<state.digit){ alert("å­—å…ƒæ•¸ä¸è¶³ï¼Œå¿…å®šé‡è¤‡"); return; }
    state.answerbyuser = false;
    state.seeother=true;
    if(!state.answerbyuser){ state.answer=state.useRepeat?RandomNumberRepeat():RandomNumberNoRepeat(); }
    const app = document.getElementById("app");
     app.innerHTML = `
        <h2 class="start-title">è«‹é¸æ“‡é›£æ˜“åº¦</h2>
        <button onclick="competeeasy2()">ç°¡å–®</button>
        <button onclick="competemid2()">ä¸­ç­‰</button>
        <button onclick="competehard2()">å›°é›£</button>
     <!-- æˆ‘ä¸æœƒå´©æ½° <input type="checkbox" id="seeeachother"> -->
        <button onclick="renderStartPage()">å›é¦–é </button>

    `;
}
function competehard2(){
    state.starttime=Date.now();
    state.difficulty=-3;
    initialcandidatescomputer();
    state.historybycomputer = [];
    state.history= [];
    initialcandidates();
    mode4Gamepage();
}
function competemid2(){
    state.starttime=Date.now();
    state.difficulty=-2;
    initialcandidatescomputer();
    state.historybycomputer = [];
    state.history= [];
    initialcandidates();
    mode4Gamepage();
}
function competeeasy2(){
    state.starttime=Date.now();
    state.difficulty=-1;
    initialcandidatescomputer();
    state.historybycomputer = [];
    state.history= [];
    initialcandidates();
    mode4Gamepage();
}
function mode4Gamepage(){
    const app=document.getElementById("app");
    let titleWords = "çŒœå°æ–¹å‡ºçš„æ•¸å­—";
    let InnerTexts = "è«‹è¼¸å…¥é›»è…¦çŒœçš„çµæœä»¥åŠä½ çš„çŒœæ¸¬";
    app.innerHTML=`
        <h2 class="game-title">${titleWords}</h2>
        <p>${InnerTexts}</p>
        <p>è«‹çŒœ${state.digit}ä½æ•¸ï¼Œä¸Šé™${state.high}ï¼Œä¸‹é™${state.low}</p>
        <p id="historys"></p>
        <p>ç¬¬ ${state.guesscount+1} æ¬¡çŒœæ¸¬</p>
        <input id="mode4_guessInput">
        <p id="text_mode4_computerguess"></p>
        <input id="A_bycomputer" type="number">
        <input id="B_bycomputer" type="number">

        <div class="btn-group main-btn">
            <button onclick="mode_4guess()">çŒœ</button>
            <button onclick="mode_4guessbyrearrange()">æˆ‘ä¾†æç¤ºç³»çµ±çŒœ</button>
            <button onclick="nextRound_mode4()">ä¸‹ä¸€æ¬¡</button>
        </div>
        <div class="btn-group helper-btn">
            <button onclick="giveHint_mode4()">æç¤º</button>
            <button onclick="giveHelp_mode4()">å¹«åŠ©</button>
            <button onclick="showLeft()">é¡¯ç¤ºå‰©é¤˜è§£æ•¸é‡</button>
            <button onclick="showcandidates()">é¡¯ç¤ºå€™é¸äºº</button>
        </div>
        <div class="btn-group danger-btn">
            <button onclick="giveUp()">æ”¾æ£„</button>
            <button onclick="renderStartPage()">å›é–‹å§‹</button>
        </div>

        <p id="result"></p>
        <p id="hint"></p>
        <p id="help"></p>
        <p id="left"></p>
        <p id="candidates"></p>
    `;
    showHistory();  
    mode4_computerguess_s();
}
function giveHint_mode4(){
    if(state.history.length===0){ alert("ç¬¬ä¸€æ¬¡æ²’æœ‰æç¤º"); return; }
    let input=document.getElementById("mode4_guessInput").value;
    if(!validGuess(input)) return;
    let a=correctguess(input);
    let msg=(a===-1)?"æ­¤çŒœæ¸¬èˆ‡æ‰€æœ‰æ­·å²ç´€éŒ„ç›¸å®¹":`èˆ‡ä½ çŒœçš„ç¬¬ ${a+1} æ¬¡çŒœæ¸¬çŸ›ç›¾`;
    document.getElementById("hint").innerText=msg;
}
function giveHelp_mode4(){
    let s2="";
    let cans=state.candidates;
    let founded=false;
    let num = Math.floor(Math.random() * cans.length);
    if (state.history.length === 0) {
        s2 = randomize(state.candidates[num]);
    }
    else{ 
        for(let i=0;i<cans.length;i++){
        let array=getPermutations(randomize(cans[(num+i)%cans.length]));
        for(let j=0;j<array.length;j++){
            if(correctguess(array[j])===-1){
                founded=true;
                s2=array[j];
                break;
            }
        }
        if(founded===true){
            break;
        }
    }
    
    }
    document.getElementById("help").innerText=`${s2} æ˜¯ä¸€çµ„è§£`;
}
function nextRound_mode4(){
    if(!state.haveGuessed){ alert("è«‹å…ˆçŒœä¸€æ¬¡"); return; }
    state.guesscount++; state.haveGuessed=false;
    mode4Gamepage();
}
function mode4_computerguess_s(){
    let s="";
    let cans=state.candidatescomputer;
    let founded=false;
    let num = Math.floor(Math.random() * cans.length);
    if (state.historybycomputer.length === 0) {
        s = randomize(state.candidatescomputer[num]);
    }
    else{ 
        for(let i=0;i<cans.length;i++){
        let array=getPermutations(randomize(cans[(num+i)%cans.length]));
        for(let j=0;j<array.length;j++){
            if(correctguesscomputer(array[j])===-1){
                founded=true;
                s=array[j];
                break;
            }
        }
        if(founded===true){
            break;
        }
    }
    
    }
    state.mode4_computerguess=s;
    document.getElementById("text_mode4_computerguess").innerText=`é›»è…¦çŒœ${s}ï¼Œå‘Šè¨´å¥¹çµæœ`;
}
function validinputAandB(){
    let s="";
    let cans=state.candidatescomputer;
    let founded=false;
    let num = Math.floor(Math.random() * cans.length);
    if (state.historybycomputer.length === 0) {
        s = randomize(state.candidatescomputer[num]);
    }
    else{ 
        for(let i=0;i<cans.length;i++){
        let array=getPermutations(randomize(cans[(num+i)%cans.length]));
        for(let j=0;j<array.length;j++){
            if(correctguesscomputer(array[j])===-1){
                founded=true;
                s=array[j];
                break;
            }
        }
        if(founded===true){
            break;
        }
    }
    
    }
    return founded;
}
function mode4_howmuchleft(a,b){
    let count2=0;
    let possibilities=state.candidates;
    let last = state.history.length - 1;
    state.history[last].A = a;
    state.history[last].B = b;
    for(let i=0;i<possibilities.length;i++){
        let maybe=getPermutations(possibilities[i]);
        for(let j=0;j<maybe.length;j++){
            if(correctguess(maybe[j])===-1){
                count2++;
            }
        }
    }
    return count2;
}
function mode4_whichAandB(){
    let tempA=1;
    let tempB=0;
    let tempLeft=0;
    for(let i=0;i<=state.digit;i++){
        for(let j=0;j<=state.digit-i;j++){
            if(mode4_howmuchleft(i,j)===0){
                continue;
            }
            if(mode4_howmuchleft(i,j)>tempLeft){
                tempA=i;
                tempB=j;
                tempLeft=mode4_howmuchleft(i,j);
            }
        }
    }
    let result=1000*tempA+tempB;
    return Number(result);
}
function mode_4guess(){
    let input=document.getElementById("mode4_guessInput").value;
    if(state.haveGuessed){ alert("æœ¬å›åˆå·²çŒœ"); return; }
    if(!validGuess(input)) return;
    
    let A_computer=document.getElementById("A_bycomputer").value;
    let B_computer=document.getElementById("B_bycomputer").value;
    
    state.historybycomputer.push({
    guess: state.mode4_computerguess,
    A: Number(A_computer),
    B: Number(B_computer)
});
    if(validinputAandB()===false){
        state.historybycomputer.pop();
        alert("è«‹è¼¸å…¥æ­£ç¢ºæ¨£è²Œ");
        return;
    }
    
    deletecandidates(false);
    let A=0;
    let B=0;
    if(state.difficulty===-3){
            /*=====ç”Ÿæˆè‹¦é€¼é¸æ‰‹=====*/
    state.history.push({guess:input,A,B});
    let giveAandB=mode4_whichAandB();
    A=Math.floor(giveAandB / 1000);
    B=giveAandB%1000;
    state.history[state.history.length-1].guess=input;
    state.history[state.history.length-1].A=A;
    state.history[state.history.length-1].B=B;
    deletecandidates(true);
    /*=====ç”Ÿæˆè‹¦é€¼é¸æ‰‹é„°æ™‚ç­”æ¡ˆ=====*/
 let  founded=false;
      let cans=state.candidates;
        let num = Math.floor(Math.random() * cans.length);
        for(let i=0;i<cans.length;i++){
        let array=getPermutations(randomize(cans[(num+i)%cans.length]));
        for(let j=0;j<array.length;j++){
            if(correctguess(array[j])===-1){
                founded=true;
                state.answer=array[j];
                break;
            }
        }
        if(founded===true){
            break;
        }
        }
    }
    else{
         A=checkA(input,state.answer);
        B=checkB(input,state.answer);
        state.history.push({guess:input,A,B});
        deletecandidates(true);
        
    }
    state.haveGuessed=true;

    document.getElementById("result").innerText=`${input} â†’ ${A}A${B}B`;
    whowin();
    showHistory();
}
function mode_4guessbyrearrange(){
    if(state.haveGuessed){ alert("æœ¬å›åˆå·²çŒœ"); return; }
    let input=document.getElementById("mode4_guessInput").value;
    if(!validGuess(input)) return;
    
    let A_computer=document.getElementById("A_bycomputer").value;
    let B_computer=document.getElementById("B_bycomputer").value;
    /*=====é›»è…¦çŒœ=====*/
state.historybycomputer.push({
    guess: state.mode4_computerguess,
    A: Number(A_computer),
    B: Number(B_computer)
});
    if(validinputAandB()===false){
        state.historybycomputer.pop();
        alert("è«‹è¼¸å…¥æ­£ç¢ºæ¨£è²Œ");
        return;
    }

    deletecandidates(false);
    /*=====é›»è…¦çŒœ=====*/
    /*=====ç”Ÿæˆè‹¦é€¼é¸æ‰‹=====*/
    let testarray=getPermutations(input);
    let founded=false;
    /*=====ç”Ÿæˆç­”æ¡ˆ=====*/
    for(let i=0;i<testarray.length;i++){
        if(correctguess(testarray[i]) === -1){
            if(correctguesscomputer(testarray[i]) !== -1&&state.seeother===true){
                continue;
            }
            alert(`ç³»çµ±æ‰¾åˆ°äº†ï¼Œå°‡çŒœæ¸¬ ${testarray[i]}`);
            input = testarray[i];
            founded=true;
            break;
        }
    }

    if(founded===false){
        alert(`ç³»çµ±æ‰¾ä¸åˆ°ï¼Œå°‡çŒœæ¸¬ ${input}`);
    }
        if(state.difficulty===-3){
            /*=====ç”Ÿæˆè‹¦é€¼é¸æ‰‹=====*/
    state.history.push({guess:input,A,B});
    let giveAandB=mode4_whichAandB();
    A=Math.floor(giveAandB / 1000);
    B=giveAandB%1000;
    state.history[state.history.length-1].guess=input;
    state.history[state.history.length-1].A=A;
    state.history[state.history.length-1].B=B;
    deletecandidates(true);
    /*=====ç”Ÿæˆè‹¦é€¼é¸æ‰‹é„°æ™‚ç­”æ¡ˆ=====*/
 let  founded=false;
      let cans=state.candidates;
        let num = Math.floor(Math.random() * cans.length);
        for(let i=0;i<cans.length;i++){
        let array=getPermutations(randomize(cans[(num+i)%cans.length]));
        for(let j=0;j<array.length;j++){
            if(correctguess(array[j])===-1){
                founded=true;
                state.answer=array[j];
                break;
            }
        }
        if(founded===true){
            break;
        }
        }
    }
    else{
         A=checkA(input,state.answer);
        B=checkB(input,state.answer);
        state.history.push({guess:input,A,B});
        deletecandidates(true);
        
    }
    state.haveGuessed=true;
    document.getElementById("result").innerText=`${input} â†’ ${A}A${B}B`;
    whowin();
    showHistory();
    deletecandidates(true);
}
function startGame3(){
    if(Istoobig()!==0){
        alert("å¤ªå¤šä½æ•¸äº†ï¼Œé€™æ¨£é›»è…¦æœƒçˆ†ç‚¸");
        return;
    }
    state.guesscount=0;
    state.haveGuessed=false;
    state.playerName=document.getElementById("nameInput").value;
    state.digit=Number(document.getElementById("digitInput").value);
    state.useRepeat=document.getElementById("useRepeat").checked;
    state.low=document.getElementById("lowInput").value;
    state.high=document.getElementById("highInput").value;

    if(state.playerName.length===0){ alert("è«‹è¼¸å…¥ç©å®¶åç¨±"); return; }
    if(CharToInt(state.low)===-1||CharToInt(state.high)===-1){ alert("æœ€ä½æˆ–æœ€é«˜ä½ä¸åˆæ³•"); return; }
    if(CharToInt(state.high)<CharToInt(state.low)){ alert("æœ€é«˜ä½ä¸èƒ½å°æ–¼æœ€ä½ä½"); return; }
    if(!state.useRepeat && CharToInt(state.high)-CharToInt(state.low)+1<state.digit){ alert("å­—å…ƒæ•¸ä¸è¶³ï¼Œå¿…å®šé‡è¤‡"); return; }
    state.answerbyuser = false;
    const app = document.getElementById("app");
    if(!state.answerbyuser){ state.answer=state.useRepeat?RandomNumberRepeat():RandomNumberNoRepeat(); }
     app.innerHTML = `
        <h2 class="start-title">è«‹é¸æ“‡é›£æ˜“åº¦</h2>
        <button onclick="competeeasy()">ç°¡å–®</button>
        <button onclick="competemid()">ä¸­ç­‰</button>
        <button onclick="competehard()">å›°é›£</button>
        å¯ä»¥äº’ç›¸çœ‹åˆ°å°æ–¹çŒœçš„æ•¸å­— <input type="checkbox" id="seeeachother" ${state.seeother?"checked":""}><br><br>
        <button onclick="renderStartPage()">å›é¦–é </button>

    `;
}
function competeeasy(){
    state.starttime=Date.now();
    state.seeother=document.getElementById("seeeachother").checked;
    state.difficulty=1;
    initialcandidatescomputer();
    initialcandidates();
    state.historybycomputer = [];
    state.history= [];
    renderGamePage();
}
function competemid(){
    state.starttime=Date.now();
    state.seeother=document.getElementById("seeeachother").checked;
    state.difficulty=2;
    initialcandidatescomputer();
    state.historybycomputer = [];
    state.history= [];
    initialcandidates();
    renderGamePage();
}
function competehard(){
    state.starttime=Date.now();
    state.seeother=document.getElementById("seeeachother").checked;
    state.difficulty=3;
    initialcandidatescomputer();
    state.historybycomputer = [];
    state.history= [];
    initialcandidates();
    renderGamePage();
}
function showdifficulty(){
    let s="";
    if(state.difficulty===1){
        s="<ç°¡å–®æ¨¡å¼>";
    }
    else if(state.difficulty===2){
        s="<ä¸­ç­‰æ¨¡å¼>";
    }
    else if(state.difficulty===3){
        s="<å›°é›£æ¨¡å¼>";
    }
    else if(state.answerbyuser===false){
        s="<é›»è…¦å‡ºé¡Œ>";
    }
    else{
        s="<ç©å®¶å‡ºé¡Œ>";
    }
    document.getElementById("givedifficulty").innerText=`æ¨¡å¼ï¼š${s} `;
}
/* ========= ä½¿ç”¨è€…å‡ºé¡Œ ========= */
function startGame2(){
    state.playerName=document.getElementById("nameInput").value;
    state.digit=Number(document.getElementById("digitInput").value);
    state.useRepeat=document.getElementById("useRepeat").checked;
    state.low=document.getElementById("lowInput").value;
    state.high=document.getElementById("highInput").value;
    

    if(state.playerName.length===0){ alert("è«‹è¼¸å…¥ç©å®¶åç¨±"); return; }
    if(CharToInt(state.low)===-1||CharToInt(state.high)===-1){ alert("æœ€ä½æˆ–æœ€é«˜ä½ä¸åˆæ³•"); return; }
    if(CharToInt(state.high)<CharToInt(state.low)){ alert("æœ€é«˜ä½ä¸èƒ½å°æ–¼æœ€ä½ä½"); return; }
    if(!state.useRepeat && CharToInt(state.high)-CharToInt(state.low)+1<state.digit){ alert("å­—å…ƒæ•¸ä¸è¶³ï¼Œå¿…å®šé‡è¤‡"); return; }
    state.answerbyuser = true;
    const app = document.getElementById("app");
    app.innerHTML = `
        <h2 class="start-title">è¼¸å…¥ç­”æ¡ˆ</h2>
        æˆ‘çš„ç­”æ¡ˆ <input id="answerInput" value="${state.answer}"><br><br>
        <button onclick="renderStartPage()">å›é¦–é </button>
        <button onclick="TostartGame()">å‡ºç™¼</button>
    `;
}

function TostartGame(){
    let input = document.getElementById("answerInput").value;
    
    if(!validGuess(input)){
        alert("è«‹è¼¸å…¥æ­£ç¢ºç­”æ¡ˆæ ¼å¼");
        return;
    }

    state.answer = input;
    state.history = [];
    state.guesscount = 0;
    state.haveGuessed = false;
    state.starttime=Date.now();
    if(Istoobig()===0){
        initialcandidates();
    }
    

    renderGamePage();
}

/* ========= é–‹å§‹éŠæˆ² ========= */
function startGame(){
    state.difficulty=0;
    const app=document.getElementById("app");
    state.guesscount=0;
    state.haveGuessed=false;
   

    state.playerName=document.getElementById("nameInput").value;
    state.digit=Number(document.getElementById("digitInput").value);
    state.useRepeat=document.getElementById("useRepeat").checked;
    state.low=document.getElementById("lowInput").value;
    state.high=document.getElementById("highInput").value;

    if(state.playerName.length===0){ alert("è«‹è¼¸å…¥ç©å®¶åç¨±"); return; }
    if(CharToInt(state.low)===-1||CharToInt(state.high)===-1){ alert("æœ€ä½æˆ–æœ€é«˜ä½ä¸åˆæ³•"); return; }
    if(CharToInt(state.high)<CharToInt(state.low)){ alert("æœ€é«˜ä½ä¸èƒ½å°æ–¼æœ€ä½ä½"); return; }
    if(!state.useRepeat && CharToInt(state.high)-CharToInt(state.low)+1<state.digit){ alert("å­—å…ƒæ•¸ä¸è¶³ï¼Œå¿…å®šé‡è¤‡"); return; }
    if(!state.answerbyuser){ state.answer=state.useRepeat?RandomNumberRepeat():RandomNumberNoRepeat(); }
    
    state.history=[]; state.guesscount=0; state.haveGuessed=false;
    state.starttime=Date.now();
    if(Istoobig()===0){
        initialcandidates();
    }
  
    renderGamePage();
}

/* ========= éŠæˆ²ç•«é¢ ========= */
function renderGamePage(){
    if(Istoobig()===1 && state.guesscount===1){
        initialcandidates2();
    }
    const app=document.getElementById("app");
    let titleWords = "";
    if(state.answerbyuser === false){
        titleWords = "çŒœé›»è…¦æ•¸å­—";
    } else {
        titleWords = `çŒœ${state.playerName}å‡ºçš„æ•¸å­—`;
    }

    let InnerTexts = "";
    if(state.answerbyuser === false){
        InnerTexts = `ç©å®¶ï¼š${state.playerName}`;
    } else {
        InnerTexts = `å‡ºé¡Œè€…ï¼š${state.playerName}`;
    }
    app.innerHTML=`
        <h2 class="game-title">${titleWords}</h2>
        <p id="givedifficulty"></p>
        <p>${InnerTexts}</p>
        <p>è«‹çŒœ${state.digit}ä½æ•¸ï¼Œä¸Šé™${state.high}ï¼Œä¸‹é™${state.low}</p>
        <p id="historys"></p>
        <p>ç¬¬ ${state.guesscount+1} æ¬¡çŒœæ¸¬</p>
        <input id="guessInput">
        

        <div class="btn-group main-btn">
            <button onclick="guess()">çŒœ</button>
            <button onclick="guessbyrearrange()">æˆ‘ä¾†æç¤ºç³»çµ±çŒœ</button>
            <button onclick="nextRound()">ä¸‹ä¸€æ¬¡</button>
        </div>
        <div class="btn-group helper-btn">
            <button onclick="giveHint()">æç¤º</button>
            <button onclick="giveHelp()">å¹«åŠ©</button>
            <button onclick="showLeft()">é¡¯ç¤ºå‰©é¤˜è§£æ•¸é‡</button>
            <button onclick="showcandidates()">é¡¯ç¤ºå€™é¸äºº</button>
        </div>
        <div class="btn-group danger-btn">
            <button onclick="giveUp()">æ”¾æ£„</button>
            <button onclick="renderStartPage()">å›é–‹å§‹</button>
        </div>

        <p id="result"></p>
        <p id="hint"></p>
        <p id="help"></p>
        <p id="left"></p>
        <p id="candidates"></p>
    `;
    showHistory();  
    showdifficulty();
}

/* ========= çŒœ ========= */
function whowin(){
    let a=state.historybycomputer.length ;
    if(state.history.length === 0 &&a === 0) return;
    if(state.difficulty===0){
        if(state.history[state.history.length-1].A === state.digit){
            victoryPage();
        }
    }
    else{
        if(state.history[state.history.length-1].A === state.digit && state.historybycomputer[state.historybycomputer.length-1].A === state.digit){
            drawPage();
        }
        else if(state.history[state.history.length-1].A === state.digit){
            victoryPage();
        }
        else if(state.historybycomputer[state.historybycomputer.length-1].A === state.digit){
            giveUp();
        }        
    }
}
function computerguess(){
    let s="";
    if (state.historybycomputer.length === 0) {
        s = randomize(state.candidatescomputer[0]);
    }
    else{
         let AsAndBs=0;
        let AsAndBs2=0;
        if (state.historybycomputer.length >=3) {
            let a=state.historybycomputer[state.historybycomputer.length-1].A+state.historybycomputer[state.historybycomputer.length-2].A;
            let b=state.historybycomputer[state.historybycomputer.length-1].B+state.historybycomputer[state.historybycomputer.length-2].B;
            let c=state.historybycomputer[state.historybycomputer.length-1].A+state.historybycomputer[state.historybycomputer.length-1].B;
            if(c===state.digit){
                AsAndBs=a;
                AsAndBs2=b;
            }
        }
    if(state.difficulty===2 && (AsAndBs<=(2*state.digit-4) ||AsAndBs2===(2*state.digit-1))){
            s=randomize(state.candidatescomputer[(Math.floor(Math.random() * state.candidatescomputer.length))%state.candidatescomputer.length]);
            }
    else if(state.difficulty===1 && AsAndBs<=2*state.digit-3||AsAndBs2===2*state.digit){
            let s1=state.candidatescomputer[Math.floor(Math.random() * state.candidatescomputer.length)];
            let s2=state.candidatescomputer[Math.floor(Math.random() * state.candidatescomputer.length)];
            let s3 = [...s1, ...s2];        // åˆä½µ
            let s4=s3;
            if(state.useRepeat===false){
                s4 = deletesame(s3);
            }       // å»é‡
            let result = s4.slice(0, state.digit); // å–å‰ N ä½
            s = result.join("");
            s=randomize(s);
            }
    else{
            s=FinGivehelp(false);
    }
    }
    let A=checkA(state.answer,s);
    let B=checkB(state.answer,s);
    state.historybycomputer.push({guess:s,A,B});
    deletecandidates(false);
}
function guess(){
    let input=document.getElementById("guessInput").value;
    if(state.haveGuessed){ alert("æœ¬å›åˆå·²çŒœ"); return; }
    if(!validGuess(input)) return;

    let A=checkA(state.answer,input);
    let B=checkB(state.answer,input);
    if(state.difficulty!==0){
        computerguess();
    }
    state.history.push({guess:input,A,B});
    state.haveGuessed=true;

    document.getElementById("result").innerText=`${input} â†’ ${A}A${B}B`;
    whowin();
    showHistory();
if(Istoobig()===0 || (Istoobig()===1&&state.guesscount>=1))    deletecandidates(true);
    if(state.seeother===true&& state.difficulty>=1){
        seeanddeletecandidates();
    }
}

/* ========= ç³»çµ±æç¤ºçŒœ ========= */
function guessbyrearrange(){
    let input=document.getElementById("guessInput").value;
    if(state.haveGuessed){ alert("æœ¬å›åˆå·²çŒœ"); return; }
    if(!validGuess(input)) return;

    let testarray=getPermutations(input);
    let founded=false;

    for(let i=0;i<testarray.length;i++){
        if(correctguess(testarray[i]) === -1){
            if(correctguesscomputer(testarray[i]) !== -1&&state.seeother===true){
                continue;
            }
            alert(`ç³»çµ±æ‰¾åˆ°äº†ï¼Œå°‡çŒœæ¸¬ ${testarray[i]}`);
            input = testarray[i];
            founded=true;
            break;
        }
    }

    if(founded===false){
        alert(`ç³»çµ±æ‰¾ä¸åˆ°ï¼Œå°‡çŒœæ¸¬ ${input}`);
    }

    let A=checkA(state.answer,input);
    let B=checkB(state.answer,input);
    if(state.difficulty!==0){
        computerguess();
    }
    state.history.push({guess:input,A,B});
    state.haveGuessed=true;

    document.getElementById("result").innerText=`${input} â†’ ${A}A${B}B`;
    whowin();
    showHistory();
    /* ========= if(A===state.digit) victoryPage(); ========= */
    if(Istoobig()===0 || (Istoobig()===1&&state.guesscount>=1))    deletecandidates(true);
    if(state.seeother===true&& state.difficulty>=1){
        seeanddeletecandidates();
    }
}

function nextRound(){
    if(!state.haveGuessed){ alert("è«‹å…ˆçŒœä¸€æ¬¡"); return; }
    if(state.seeother===true&&state.difficulty>=1){
        seeanddeletecandidates();
    }
    state.guesscount++; state.haveGuessed=false;
    renderGamePage();
}

/* ========= æç¤º ========= */
function correctguess(s){
    for(let i=0;i<state.history.length;i++){
        let h=state.history[i];
        if(checkA(h.guess,s)!==h.A || checkB(h.guess,s)!==h.B) return i;
    }
    return -1;
}
function correctguesscomputer(s){
    if(state.difficulty===-1){
        return -1;
    }
    for(let i=0;i<state.historybycomputer.length;i++){
        let h=state.historybycomputer[i];
        if(checkA(h.guess,s)!==h.A || checkB(h.guess,s)!==h.B) return i;
    }
    return -1;
}

function giveHint(){
    if(state.history.length===0){ alert("ç¬¬ä¸€æ¬¡æ²’æœ‰æç¤º"); return; }
    let input=document.getElementById("guessInput").value;
    if(!validGuess(input)) return;
    let a=correctguess(input);
    let msg=(a===-1)?"æ­¤çŒœæ¸¬èˆ‡æ‰€æœ‰æ­·å²ç´€éŒ„ç›¸å®¹":`èˆ‡ä½ çŒœçš„ç¬¬ ${a+1} æ¬¡çŒœæ¸¬çŸ›ç›¾`;
    if(a===-1){
        a=correctguesscomputer(input);
        msg=(a===-1)?"æ­¤çŒœæ¸¬èˆ‡æ‰€æœ‰æ­·å²ç´€éŒ„ç›¸å®¹":`èˆ‡é›»è…¦çŒœçš„ç¬¬ ${a+1} æ¬¡çŒœæ¸¬çŸ›ç›¾`;
    }
    document.getElementById("hint").innerText=msg;
}

/* ========= å¹«åŠ© ========= */
function giveHelp(){
    if(Istoobig()===2){
        alert("æ•¸å­—å¤ªå¤§ä¸å¯ä»¥ç”¨");
        return;
    }
    if(Istoobig()===1&&state.guesscount===0){
        alert("æ•¸å­—å¤ªå¤§ï¼Œç¬¬ä¸€æ¬¡ä¸å¯ç”¨");
        return;
    }
    let s2="";
    if(state.guesscount!==0){
        s2=FinGivehelp(true);
    }else{
        s2=state.useRepeat?RandomNumberRepeat():RandomNumberNoRepeat(); 
    }
    document.getElementById("help").innerText=`${s2} æ˜¯ä¸€çµ„è§£`;
}
function FinGivehelp(a){/* ========= trueæ˜¯ä½¿ç”¨è€… ========= */
    let s2="";
    let founded=false;
    let cans=[];
    if(state.difficulty===0){
        cans=state.candidates;
        let num = Math.floor(Math.random() * cans.length);
        for(let i=0;i<cans.length;i++){
        let array=getPermutations(randomize(cans[(num+i)%cans.length]));
        for(let j=0;j<array.length;j++){
            if(correctguess(array[j])===-1){
                founded=true;
                s2=array[j];
                break;
            }
        }
        if(founded===true){
            break;
        }
        }
    }
    else if(state.difficulty>=0){
        if(a===true){
            cans=state.candidates;
            let num = Math.floor(Math.random() * cans.length);
            for(let i=0;i<cans.length;i++){
            let array=getPermutations(randomize(cans[(num+i)%cans.length]));
            for(let j=0;j<array.length;j++){
            if(correctguess(array[j])===-1){
                if(correctguesscomputer(array[j])!==-1 && state.seeother===true){
                    continue;
                }
                founded=true;
                s2=array[j];
                break;
            }
        }
            if(founded===true){
                break;
            }
            }
        }
      else{
          cans=state.candidatescomputer;
          let num = Math.floor(Math.random() * cans.length);
        
        for(let i=0;i<cans.length;i++){
        let array=getPermutations(randomize(cans[(num+i)%cans.length]));
        for(let j=0;j<array.length;j++){
            if(correctguesscomputer(array[j])===-1){
                if(correctguess(array[j])!==-1 && state.seeother===true){
                    continue;
                }
                founded=true;
                s2=array[j];
                break;
            }
        }
        if(founded===true){
            break;
        }
    }
    }
    }
    
    
    return s2;
}
/* ========= å‰©é¤˜è§£ ========= */
function showLeft(){
    if(state.candidates.length === 0){
    alert("å°šæœªå»ºç«‹å€™é¸é›†åˆ");
    return;
    }
    if(Istoobig()===2){
        alert("æ•¸å­—å¤ªå¤§ä¸å¯ä»¥ç”¨");
        return;
    }
    if(Istoobig()===1&&state.guesscount===0){
        alert("æ•¸å­—å¤ªå¤§ï¼Œç¬¬ä¸€æ¬¡ä¸å¯ç”¨");
        return;
    }
    let count2=0;
    let possibilities=state.candidates;
    let possibilities2=state.candidatescomputer;
    for(let i=0;i<possibilities.length;i++){
        let maybe=getPermutations(possibilities[i]);
        for(let j=0;j<maybe.length;j++){
            if(correctguess(maybe[j])===-1){
                count2++;
            }
        }
    }
    document.getElementById("left").innerText=`å‰©ä¸‹${count2}çµ„è§£`;
}

/* ========= çµæœ ========= */
function victoryPage(){
    let b=state.answer;
    const app=document.getElementById("app");
    let a=spendtime();
    state.seeother=true;
    app.innerHTML=`
        <h2 class="win-title">ğŸ‰ æ­å–œçŒœä¸­ï¼</h2>
        <p id="historys"></p>
        <p>ç­”æ¡ˆï¼š${b}</p>
        <p>è€—æ™‚ï¼š${a}ç§’</p>
        <button onclick="renderStartPage()">å›é–‹å§‹</button>
    `;
    showHistory();
}
function giveUp(){
    const app=document.getElementById("app");
    let a=spendtime();
    let b=state.answer;
    let c="qwer";
    state.seeother=true;
    app.innerHTML=`
        <h2 class="lose-title">ä½ è¼¸äº†</h2>
        <p id="historys"></p>
        <p>ç­”æ¡ˆï¼š${b}</p>
        <p>è€—æ™‚ï¼š${a}ç§’</p>
        <button onclick="renderStartPage()">å›é–‹å§‹</button>
    `;
    showHistory();
}
function drawPage(){
    const app=document.getElementById("app");
    let a=spendtime();
    state.seeother=true;
    let b=state.answer;
    app.innerHTML=`
        <h2 class="lose-title">å¹³æ‰‹</h2>
        <p id="historys"></p>
        <p>ç­”æ¡ˆï¼š${b}</p>
        <p>è€—æ™‚ï¼š${a}ç§’</p>
        <button onclick="renderStartPage()">å›é–‹å§‹</button>
    `;
    showHistory();
}

/* ========= æ­·å² ========= */
function showHistory(){
    let html="<b>æ­·å²ç´€éŒ„</b><br>";
    if(state.difficulty!==-1){
        html+=` ${state.playerName} çŒœçš„<br>`
    }
    if(state.history.length===0) html+="æš«ç„¡ç´€éŒ„";
    state.history.forEach((h,i)=>{
        html+=`ç¬¬ ${i+1} æ¬¡ï¼š${h.guess} â†’ ${h.A}A${h.B}B<br>`;
    });
    if(state.difficulty!==-1){
        html+=` <br>é›»è…¦çŒœçš„<br>`
        state.historybycomputer.forEach((h,i)=>{
            if(state.seeother===true){
            html+=`ç¬¬ ${i+1} æ¬¡ï¼š${h.guess} â†’ ${h.A}A${h.B}B<br>`;
            }
            else{
                html+=`ç¬¬ ${i+1} æ¬¡ï¼š ${h.A}A${h.B}B<br>`;
            }
        });
    }
    document.getElementById("historys").innerHTML=html;
}

/* ========= é©—è­‰ ========= */
function validGuess(input){
    if(input.length!==state.digit){ alert("è¼¸å…¥é•·åº¦éŒ¯èª¤"); return false; }
    for(let c of input){
        let idx=CharToInt(c);
        if(idx===-1||idx<CharToInt(state.low)||idx>CharToInt(state.high)){
            alert("å«éæ³•æˆ–è¶…å‡ºç¯„åœå­—å…ƒ"); return false;
        }
    }
    if(!state.useRepeat && new Set(input).size!==input.length){ alert("ä¸å…è¨±é‡è¤‡"); return false; }
    return true;
}

/* ========= åˆ¤æ–· ========= */
function checkA(a,g){ let A=0; for(let i=0;i<a.length;i++) if(a[i]===g[i]) A++; return A; }
function checkB(a,g){ let B=0; for(let i=CharToInt(state.low);i<=CharToInt(state.high);i++){ let c=allowedChars[i]; B+=Math.min(countChar(a,c),countChar(g,c)); } return B-checkA(a,g); }
function checkAplusB(a,g){
    return checkA(a,g)+checkB(a,g)
}
/* ========= äº‚æ•¸ ========= */
function RandomNumberRepeat(){ let r="",s=CharToInt(state.low),e=CharToInt(state.high); for(let i=0;i<state.digit;i++) r+=allowedChars[s+Math.floor(Math.random()*(e-s+1))]; return r; }
function RandomNumberNoRepeat(){ let pool=allowedChars.slice(CharToInt(state.low),CharToInt(state.high)+1).split(""); let r=""; for(let i=0;i<state.digit;i++){ let idx=Math.floor(Math.random()*pool.length); r+=pool.splice(idx,1)[0]; } return r; }

</script>
</body>
</html>
